<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>GLM 직접 테스트</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #e0e0e0; 
        }
        .test { 
            margin: 20px 0; 
            padding: 15px; 
            background: #2a2a2a; 
            border-radius: 8px; 
        }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            background: #667eea; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        pre { 
            white-space: pre-wrap; 
            word-wrap: break-word; 
        }
    </style>
</head>
<body>
    <h1>GLM-4.6 Cloud 모델 테스트</h1>
    
    <button onclick="testChat()">Chat 엔드포인트 테스트</button>
    <button onclick="testGenerate()">Generate 엔드포인트 테스트</button>
    <button onclick="listModels()">모델 목록 확인</button>
    
    <div id="results"></div>
    
    <script>
        function log(message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = 'test';
            div.innerHTML = `<pre>${message}</pre>`;
            results.prepend(div);
        }
        
        async function testChat() {
            log('Chat 엔드포인트 테스트 시작...');
            
            try {
                const response = await fetch('http://localhost:11434/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'glm-4.6:cloud',
                        messages: [
                            { role: 'user', content: '안녕하세요. 한국어로 답해주세요.' }
                        ],
                        stream: false
                    })
                });
                
                const text = await response.text();
                const data = JSON.parse(text);
                
                log(`Chat 응답:\n${JSON.stringify(data, null, 2)}`);
                
                if (data.message?.content) {
                    log(`✅ Chat 성공!\n콘텐츠: ${data.message.content}`);
                } else {
                    log(`⚠️ Chat 응답에 콘텐츠 없음`);
                }
                
            } catch (error) {
                log(`❌ Chat 오류: ${error.message}\n${error.stack}`);
            }
        }
        
        async function testGenerate() {
            log('Generate 엔드포인트 테스트 시작...');
            
            try {
                const response = await fetch('http://localhost:11434/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'glm-4.6:cloud',
                        prompt: '안녕하세요. 한국어로 답해주세요.',
                        stream: false
                    })
                });
                
                const text = await response.text();
                const data = JSON.parse(text);
                
                log(`Generate 응답:\n${JSON.stringify(data, null, 2)}`);
                
                if (data.response) {
                    log(`✅ Generate 성공!\n콘텐츠: ${data.response}`);
                } else {
                    log(`⚠️ Generate 응답에 콘텐츠 없음`);
                }
                
            } catch (error) {
                log(`❌ Generate 오류: ${error.message}\n${error.stack}`);
            }
        }
        
        async function listModels() {
            log('모델 목록 조회 중...');
            
            try {
                const response = await fetch('http://localhost:11434/api/tags');
                const data = await response.json();
                
                const cloudModels = data.models?.filter(m => m.name.includes('cloud')) || [];
                
                log(`클라우드 모델 목록:\n${cloudModels.map(m => `- ${m.name}`).join('\n')}`);
                
                // GLM 모델 확인
                const glmModel = data.models?.find(m => m.name.includes('glm'));
                if (glmModel) {
                    log(`✅ GLM 모델 발견: ${glmModel.name}`);
                } else {
                    log(`⚠️ GLM 모델을 찾을 수 없음`);
                    log(`전체 모델 목록:\n${data.models?.map(m => m.name).join('\n')}`);
                }
                
            } catch (error) {
                log(`❌ 모델 목록 조회 오류: ${error.message}`);
            }
        }
        
        // 페이지 로드 시 모델 목록 확인
        window.onload = () => {
            listModels();
        };
    </script>
</body>
</html>