<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6-AI 멀티 모델 블로그 시스템</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .input-section {
            background: #1a1a1a;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #667eea;
        }
        
        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px;
            background: #0a0a0a;
            border: 2px solid #333;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 15px;
        }
        
        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .input-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #333;
            color: #e0e0e0;
        }
        
        .btn-secondary:hover {
            background: #444;
        }
        
        .btn.loading {
            background: #f59e0b;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            min-height: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 10px;
        }
        
        .model-card {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #333;
            transition: all 0.3s;
        }
        
        .model-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .model-card.processing {
            border-color: #f59e0b;
            background: #1a1500;
        }
        
        .model-card.completed {
            border-color: #22c55e;
            background: #0a1a0a;
        }
        
        .model-card.error {
            border-color: #ef4444;
            background: #1a0a0a;
        }
        
        .model-card.selected {
            border-color: #667eea;
            background: #1a1a3a;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        .model-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }
        
        .model-name {
            font-size: 18px;
            font-weight: 700;
        }
        
        .model-badge {
            padding: 4px 8px;
            background: #667eea;
            color: white;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .model-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .status-waiting {
            background: #333;
            color: #999;
        }
        
        .status-processing {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .model-content {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .model-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .metric {
            background: #0a0a0a;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
        }
        
        .metric-label {
            font-size: 11px;
            color: #999;
            margin-bottom: 4px;
        }
        
        .metric-value {
            font-size: 16px;
            font-weight: 700;
            color: #667eea;
        }
        
        .select-btn {
            width: 100%;
            margin-top: 10px;
            padding: 8px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .select-btn:hover {
            background: #5568d3;
        }
        
        .comparison-section {
            background: #1a1a1a;
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .comparison-item {
            text-align: center;
        }
        
        .comparison-model {
            font-weight: 600;
            margin-bottom: 10px;
            color: #667eea;
        }
        
        .comparison-score {
            font-size: 32px;
            font-weight: 700;
        }
        
        .winner {
            color: #22c55e;
        }
        
        .spinner {
            border: 3px solid #333;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .final-output {
            background: #1a1a1a;
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
            display: none;
        }
        
        .final-output.show {
            display: block;
        }
        
        .final-content {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            line-height: 1.8;
            font-size: 16px;
        }
        
        .model-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .model-toggle {
            padding: 8px 16px;
            background: #333;
            border: 2px solid #333;
            border-radius: 8px;
            color: #999;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .model-toggle.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }
        
        .model-toggle:hover {
            border-color: #667eea;
        }
        
        .status-summary {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-value {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }
        
        .summary-label {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>6-AI 멀티 모델 블로그 시스템</h1>
        <p>6개의 최강 AI 모델이 동시에 콘텐츠를 생성합니다</p>
    </div>
    
    <div class="container">
        <!-- 입력 섹션 -->
        <div class="input-section">
            <h2 style="margin-bottom: 20px; color: #667eea;">
                <i class="fas fa-pen"></i> 콘텐츠 생성 설정
            </h2>
            
            <div class="model-selector">
                <label style="margin-right: 10px;">활성 모델:</label>
                <div class="model-toggle active" data-model="gemini-flash" onclick="toggleModel(this)">Gemini 2.0 Flash</div>
                <div class="model-toggle active" data-model="gemini-pro" onclick="toggleModel(this)">Gemini 2.0 Flash Pro</div>
                <div class="model-toggle active" data-model="deepseek" onclick="toggleModel(this)">DeepSeek (671B)</div>
                <div class="model-toggle active" data-model="qwen" onclick="toggleModel(this)">Qwen3 (480B)</div>
                <div class="model-toggle active" data-model="gpt-oss" onclick="toggleModel(this)">GPT-OSS (120B)</div>
                <div class="model-toggle active" data-model="kimi" onclick="toggleModel(this)">Kimi K2 (1T)</div>
            </div>
            
            <div class="input-group">
                <label>주제 / 제목</label>
                <input type="text" id="topic" placeholder="예: AI가 바꾸는 미래의 교육" value="AI가 바꾸는 미래의 교육">
            </div>
            
            <div class="input-group">
                <label>상세 프롬프트 (선택)</label>
                <textarea id="prompt" placeholder="추가적인 지시사항이나 요구사항을 입력하세요..."></textarea>
            </div>
            
            <div class="input-group">
                <label>콘텐츠 타입</label>
                <select id="contentType">
                    <option value="blog">블로그 포스트</option>
                    <option value="article">기사</option>
                    <option value="tutorial">튜토리얼</option>
                    <option value="review">리뷰</option>
                    <option value="story">스토리</option>
                </select>
            </div>
            
            <div class="input-group">
                <label>길이 설정</label>
                <select id="length">
                    <option value="short">짧게 (200자)</option>
                    <option value="medium" selected>보통 (500자)</option>
                    <option value="long">길게 (1000자)</option>
                </select>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="generateAll()">
                    <i class="fas fa-rocket"></i> 6개 모델 동시 생성
                </button>
                <button class="btn btn-secondary" onclick="generateBest()">
                    <i class="fas fa-star"></i> 최고 모델만 생성
                </button>
                <button class="btn btn-secondary" onclick="mixAllWithGemini()">
                    <i class="fas fa-blender"></i> Gemini 통합 생성
                </button>
                <button class="btn btn-secondary" onclick="compareSpeed()">
                    <i class="fas fa-tachometer-alt"></i> 속도 테스트
                </button>
                <button class="btn btn-secondary" onclick="saveResults()">
                    <i class="fas fa-save"></i> 결과 저장
                </button>
            </div>
        </div>
        
        <!-- 상태 요약 -->
        <div class="status-summary" id="statusSummary" style="display: none;">
            <div class="summary-item">
                <div class="summary-value" id="activeCount">0</div>
                <div class="summary-label">실행 중</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="completedCount">0</div>
                <div class="summary-label">완료</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="errorCount">0</div>
                <div class="summary-label">오류</div>
            </div>
            <div class="summary-item">
                <div class="summary-value" id="avgTime">0ms</div>
                <div class="summary-label">평균 시간</div>
            </div>
        </div>
        
        <!-- 모델별 결과 -->
        <div class="models-grid" id="modelsGrid">
            <!-- 동적으로 생성됨 -->
        </div>
        
        <!-- 비교 분석 -->
        <div class="comparison-section" id="comparisonSection" style="display: none;">
            <h2 style="color: #667eea; margin-bottom: 20px;">
                <i class="fas fa-chart-bar"></i> 모델 성능 비교
            </h2>
            <div class="comparison-grid" id="comparisonGrid">
                <!-- 동적으로 생성됨 -->
            </div>
        </div>
        
        <!-- 최종 선택된 콘텐츠 -->
        <div class="final-output" id="finalOutput">
            <h2 style="color: #667eea; margin-bottom: 20px;">
                <i class="fas fa-trophy"></i> 최종 선택 콘텐츠
            </h2>
            <div id="selectedModel" style="margin-bottom: 10px; color: #22c55e; font-weight: 600;"></div>
            <div class="final-content" id="finalContent"></div>
            <div class="button-group" style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="publishContent()">
                    <i class="fas fa-upload"></i> 발행
                </button>
                <button class="btn btn-secondary" onclick="editContent()">
                    <i class="fas fa-edit"></i> 편집
                </button>
                <button class="btn btn-secondary" onclick="regenerate()">
                    <i class="fas fa-redo"></i> 재생성
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // 모델 정의
        const models = {
            'gemini-flash': {
                id: 'gemini-2.0-flash-exp',
                name: 'Gemini 2.0 Flash',
                type: 'gemini',
                apiKey: 'AIzaSyAmLSwyMGCkDpSojwPjQwTnYmlAQjrdH7g',
                params: 'Flash 2.0',
                active: true
            },
            'gemini-pro': {
                id: 'gemini-2.0-flash',
                name: 'Gemini 2.0 Flash Pro',
                type: 'gemini',
                apiKey: 'AIzaSyAmLSwyMGCkDpSojwPjQwTnYmlAQjrdH7g',
                params: 'Flash 2.0 Pro',
                active: true
            },
            'deepseek': {
                id: 'deepseek-v3.1:671b-cloud',
                name: 'DeepSeek v3.1',
                type: 'ollama',
                params: '671B',
                active: true
            },
            'qwen': {
                id: 'qwen3-coder:480b-cloud',
                name: 'Qwen3 Coder',
                type: 'ollama',
                params: '480B',
                active: true
            },
            'gpt-oss': {
                id: 'gpt-oss:120b-cloud',
                name: 'GPT-OSS',
                type: 'ollama',
                params: '120B',
                active: true
            },
            'kimi': {
                id: 'kimi-k2:1t-cloud',
                name: 'Kimi K2',
                type: 'ollama',
                params: '1T',
                active: true
            }
        };
        
        let results = {};
        let selectedModelId = null;
        
        // 모델 토글
        function toggleModel(element) {
            element.classList.toggle('active');
            const modelKey = element.dataset.model;
            models[modelKey].active = element.classList.contains('active');
        }
        
        // 모델 카드 초기화
        function initializeGrid() {
            const grid = document.getElementById('modelsGrid');
            grid.innerHTML = '';
            results = {};
            
            console.log('Initializing grid with models:', models);
            let cardCount = 0;
            
            Object.entries(models).forEach(([key, model]) => {
                if (!model.active) {
                    console.log(`Skipping inactive model: ${key}`);
                    return;
                }
                
                cardCount++;
                console.log(`Creating card ${cardCount} for ${key}:`, model.name);
                
                const card = document.createElement('div');
                card.className = 'model-card';
                card.id = `card-${key}`;
                
                card.innerHTML = `
                    <div class="model-header">
                        <div class="model-name">${model.name}</div>
                        <div class="model-badge">${model.params}</div>
                    </div>
                    <div class="model-status status-waiting">
                        <i class="fas fa-clock"></i> 대기 중
                    </div>
                    <div class="model-content" style="display: none;"></div>
                    <div class="model-metrics" style="display: none;">
                        <div class="metric">
                            <div class="metric-label">응답 시간</div>
                            <div class="metric-value">-</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">토큰 수</div>
                            <div class="metric-value">-</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">품질</div>
                            <div class="metric-value">-</div>
                        </div>
                    </div>
                    <button class="select-btn" onclick="selectModel('${key}')" style="display: none;">
                        이 콘텐츠 선택
                    </button>
                `;
                
                grid.appendChild(card);
                console.log(`Added card to grid: ${key}`);
            });
            
            console.log(`Total cards created: ${cardCount}`);
            console.log(`Grid children count: ${grid.children.length}`);
            console.log('Grid HTML:', grid.innerHTML.substring(0, 500) + '...');
        }
        
        // 전체 생성
        async function generateAll() {
            const topic = document.getElementById('topic').value;
            const prompt = document.getElementById('prompt').value;
            const contentType = document.getElementById('contentType').value;
            const length = document.getElementById('length').value;
            
            if (!topic) {
                alert('주제를 입력해주세요');
                return;
            }
            
            // 프롬프트 구성
            const lengthMap = {
                short: 200,
                medium: 500,
                long: 1000
            };
            
            const fullPrompt = `
주제: ${topic}
타입: ${contentType}
길이: 약 ${lengthMap[length]}자

${prompt ? `추가 요구사항: ${prompt}` : ''}

위 주제로 ${contentType} 형식의 콘텐츠를 ${lengthMap[length]}자 내외로 작성해주세요.
한국어로 작성하고, 전문적이면서도 읽기 쉽게 작성해주세요.
            `.trim();
            
            initializeGrid();
            document.getElementById('statusSummary').style.display = 'flex';
            document.getElementById('finalOutput').classList.remove('show');
            
            // 활성 모델만 실행
            const activeModels = Object.entries(models).filter(([_, m]) => m.active);
            updateStatus(activeModels.length, 0, 0);
            
            // 병렬 실행
            const promises = activeModels.map(([key, model]) => 
                generateForModel(key, model, fullPrompt)
            );
            
            await Promise.allSettled(promises);
            
            // 모든 카드 상태 확인
            console.log('=== Final Card Status Check ===');
            Object.keys(models).forEach(key => {
                if (!models[key].active) return;
                
                const card = document.getElementById(`card-${key}`);
                const contentEl = card?.querySelector('.model-content');
                
                console.log(`${key} (${models[key].name}):`, {
                    cardExists: !!card,
                    hasCompleted: card?.classList.contains('completed'),
                    contentDisplay: contentEl?.style.display,
                    contentLength: contentEl?.textContent?.length || 0,
                    resultSuccess: results[key]?.success,
                    resultContent: results[key]?.content?.substring(0, 50) + '...'
                });
            });
            console.log('===============================');
            
            // 결과 분석 및 비교
            showComparison();
        }
        
        // 개별 모델 생성
        async function generateForModel(key, model, prompt) {
            const card = document.getElementById(`card-${key}`);
            const statusEl = card.querySelector('.model-status');
            const contentEl = card.querySelector('.model-content');
            const metricsEl = card.querySelector('.model-metrics');
            
            card.classList.add('processing');
            statusEl.className = 'model-status status-processing';
            statusEl.innerHTML = '<div class="spinner"></div> 생성 중...';
            
            const startTime = Date.now();
            
            try {
                let response;
                
                if (model.type === 'gemini') {
                    // Gemini API
                    console.log(`[${key}] Calling Gemini ${model.name} with model ID: ${model.id}`);
                    
                    const requestBody = {
                        contents: [{
                            parts: [{ text: prompt }]
                        }],
                        generationConfig: {
                            temperature: 0.8,
                            maxOutputTokens: 1500,
                            topP: 0.95
                        }
                    };
                    
                    console.log(`[${key}] Request body:`, JSON.stringify(requestBody, null, 2));
                    
                    response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/${model.id}:generateContent?key=${model.apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(requestBody)
                        }
                    );
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`[${key}] Gemini error: ${response.status}`, errorText);
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                    
                    const data = await response.json();
                    console.log(`[${key}] Gemini response for ${model.name}:`, data);
                    const content = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
                    
                    console.log(`[${key}] Gemini ${model.name} content length: ${content.length}`);
                    console.log(`[${key}] Gemini ${model.name} content preview:`, content.substring(0, 200));
                    
                    if (!content) {
                        console.error(`[${key}] No content in Gemini response for ${model.name}`);
                        console.error(`[${key}] Full response structure:`, JSON.stringify(data, null, 2));
                    }
                    
                    results[key] = {
                        content: content || '콘텐츠를 생성하지 못했습니다.',
                        duration: Date.now() - startTime,
                        tokens: content.length,
                        success: !!content
                    };
                    
                } else {
                    // Ollama API
                    console.log(`[${key}] Calling Ollama ${model.name} (${model.id})...`);
                    
                    // 모든 Ollama 모델들은 chat 엔드포인트 사용
                    const chatRequest = {
                        model: model.id,
                        messages: [
                            { role: 'user', content: prompt }
                        ],
                        stream: false,
                        options: {
                            temperature: 0.8,
                            num_predict: 1500
                        }
                    };
                    
                    console.log(`[${key}] Ollama chat request:`, JSON.stringify(chatRequest, null, 2));
                    
                    response = await fetch('http://localhost:11434/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(chatRequest)
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`[${key}] Ollama error for ${model.name}: ${response.status}`, errorText);
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                    
                    const data = await response.json();
                    console.log(`[${key}] Ollama response for ${model.name}:`, data);
                    const content = data.message?.content || '';
                    
                    console.log(`[${key}] Ollama ${model.name} content length: ${content.length}`);
                    console.log(`[${key}] Ollama ${model.name} content preview:`, content.substring(0, 200));
                    
                    if (!content) {
                        console.error(`[${key}] No content in Ollama response for ${model.name}`);
                        console.error(`[${key}] Full Ollama response:`, JSON.stringify(data, null, 2));
                    }
                    
                    results[key] = {
                        content: content || '콘텐츠를 생성하지 못했습니다.',
                        duration: Date.now() - startTime,
                        tokens: content.length,
                        success: !!content
                    };
                }
                
                // 성공 표시
                console.log(`[${key}] Updating UI for ${model.name}...`);
                console.log(`[${key}] Content to display:`, results[key].content.substring(0, 100) + '...');
                
                card.classList.remove('processing');
                card.classList.add('completed');
                statusEl.className = 'model-status status-completed';
                statusEl.innerHTML = '<i class="fas fa-check"></i> 완료';
                
                contentEl.style.display = 'block';
                contentEl.textContent = results[key].content;
                console.log(`[${key}] Content element updated. Display:`, contentEl.style.display);
                console.log(`[${key}] Content element text length:`, contentEl.textContent.length);
                
                metricsEl.style.display = 'grid';
                metricsEl.querySelectorAll('.metric-value')[0].textContent = `${results[key].duration}ms`;
                metricsEl.querySelectorAll('.metric-value')[1].textContent = results[key].tokens;
                metricsEl.querySelectorAll('.metric-value')[2].textContent = calculateQuality(results[key].content);
                
                card.querySelector('.select-btn').style.display = 'block';
                
                console.log(`[${key}] UI update complete for ${model.name}`);
                updateCompletedCount();
                
            } catch (error) {
                // 오류 표시
                card.classList.remove('processing');
                card.classList.add('error');
                statusEl.className = 'model-status status-error';
                statusEl.innerHTML = '<i class="fas fa-times"></i> 오류';
                
                contentEl.style.display = 'block';
                contentEl.textContent = `오류: ${error.message}`;
                
                results[key] = {
                    error: error.message,
                    success: false
                };
                
                updateErrorCount();
            }
        }
        
        // 품질 계산
        function calculateQuality(content) {
            let score = 0;
            
            // 길이
            if (content.length > 200) score += 25;
            if (content.length > 500) score += 25;
            
            // 구조
            if (content.includes('\n')) score += 20;
            if (content.includes('.') || content.includes('!')) score += 15;
            
            // 한글 포함
            if (/[가-힣]/.test(content)) score += 15;
            
            return Math.min(100, score);
        }
        
        // 상태 업데이트
        function updateStatus(total, completed, errors) {
            document.getElementById('activeCount').textContent = total - completed - errors;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('errorCount').textContent = errors;
        }
        
        function updateCompletedCount() {
            const completed = Object.values(results).filter(r => r.success).length;
            const errors = Object.values(results).filter(r => !r.success).length;
            const total = Object.keys(models).filter(k => models[k].active).length;
            
            updateStatus(total, completed, errors);
            
            // 평균 시간 계산
            const times = Object.values(results).filter(r => r.success).map(r => r.duration);
            if (times.length > 0) {
                const avgTime = Math.round(times.reduce((a, b) => a + b, 0) / times.length);
                document.getElementById('avgTime').textContent = `${avgTime}ms`;
            }
        }
        
        function updateErrorCount() {
            updateCompletedCount();
        }
        
        // 비교 표시
        function showComparison() {
            const section = document.getElementById('comparisonSection');
            const grid = document.getElementById('comparisonGrid');
            
            grid.innerHTML = '';
            
            const successfulResults = Object.entries(results)
                .filter(([_, r]) => r.success)
                .sort((a, b) => b[1].tokens - a[1].tokens);
            
            successfulResults.forEach(([key, result], index) => {
                const item = document.createElement('div');
                item.className = 'comparison-item';
                
                const quality = calculateQuality(result.content);
                const isWinner = index === 0;
                
                item.innerHTML = `
                    <div class="comparison-model">${models[key].name}</div>
                    <div class="comparison-score ${isWinner ? 'winner' : ''}">${quality}</div>
                    <div style="font-size: 12px; color: #999;">
                        ${result.duration}ms / ${result.tokens}자
                    </div>
                `;
                
                grid.appendChild(item);
            });
            
            section.style.display = 'block';
        }
        
        // 모델 선택
        function selectModel(key) {
            selectedModelId = key;
            
            // 모든 카드 선택 해제
            document.querySelectorAll('.model-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // 선택된 카드 하이라이트
            document.getElementById(`card-${key}`).classList.add('selected');
            
            // 최종 출력 표시
            const finalOutput = document.getElementById('finalOutput');
            finalOutput.classList.add('show');
            
            document.getElementById('selectedModel').textContent = 
                `선택된 모델: ${models[key].name} (${models[key].params})`;
            document.getElementById('finalContent').textContent = results[key].content;
        }
        
        // 최고 모델만 생성
        async function generateBest() {
            // DeepSeek 671B를 기본 최고 모델로 사용
            const bestModel = models['deepseek'];
            const topic = document.getElementById('topic').value;
            
            if (!topic) {
                alert('주제를 입력해주세요');
                return;
            }
            
            initializeGrid();
            
            // DeepSeek만 표시
            const card = document.createElement('div');
            card.className = 'model-card';
            card.id = 'card-deepseek';
            
            document.getElementById('modelsGrid').innerHTML = '';
            document.getElementById('modelsGrid').appendChild(card);
            
            await generateForModel('deepseek', bestModel, topic);
        }
        
        // 속도 테스트
        async function compareSpeed() {
            const testPrompt = "Hello, respond in 5 words";
            initializeGrid();
            await generateAll();
        }
        
        // 결과 저장
        function saveResults() {
            const data = {
                topic: document.getElementById('topic').value,
                results: results,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('multiModelResults', JSON.stringify(data));
            alert('결과가 저장되었습니다!');
        }
        
        // 발행
        function publishContent() {
            if (!selectedModelId || !results[selectedModelId]) {
                alert('먼저 콘텐츠를 선택해주세요');
                return;
            }
            
            // 실제 발행 로직
            console.log('Publishing:', results[selectedModelId]);
            alert('콘텐츠가 발행되었습니다!');
        }
        
        // 편집
        function editContent() {
            const content = document.getElementById('finalContent');
            content.contentEditable = true;
            content.style.border = '2px solid #667eea';
            content.focus();
        }
        
        // 재생성
        async function regenerate() {
            await generateAll();
        }
        
        // Gemini로 모든 결과 통합
        async function mixAllWithGemini() {
            const topic = document.getElementById('topic').value;
            if (!topic) {
                alert('먼저 주제를 입력해주세요');
                return;
            }
            
            // 먼저 7개 모델 생성
            await generateAll();
            
            // 성공한 결과들만 필터링
            const successfulResults = Object.entries(results)
                .filter(([_, r]) => r.success && r.content)
                .map(([key, r]) => ({
                    model: models[key].name,
                    content: r.content
                }));
            
            if (successfulResults.length < 2) {
                alert('통합하려면 최소 2개 이상의 모델이 콘텐츠를 생성해야 합니다');
                return;
            }
            
            // 통합 프롬프트 생성
            const mixPrompt = `
다음은 "${topic}" 주제로 여러 AI 모델이 생성한 콘텐츠입니다.
이들을 분석하여 각 모델의 장점을 살려 하나의 완성도 높은 콘텐츠로 재구성해주세요.

${successfulResults.map(r => `
[${r.model}의 콘텐츠]:
${r.content}
`).join('\n---\n')}

통합 원칙:
1. 각 모델의 핵심 아이디어와 장점을 추출
2. 중복 제거하고 논리적 흐름 개선
3. 전문적이면서도 읽기 쉬운 문체로 통일
4. 도입-본론-결론 구조로 재구성
5. 약 800-1000자 분량

한국어로 작성해주세요.
            `.trim();
            
            try {
                // Gemini Pro로 통합
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${models['gemini-pro'].apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: mixPrompt }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 2000,
                                topP: 0.9
                            }
                        })
                    }
                );
                
                if (!response.ok) throw new Error('Gemini 통합 실패');
                
                const data = await response.json();
                const mixedContent = data.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (mixedContent) {
                    // 통합 결과를 별도 섹션에 표시
                    showMixedResult(mixedContent, successfulResults.length);
                } else {
                    alert('통합 콘텐츠 생성에 실패했습니다');
                }
                
            } catch (error) {
                console.error('통합 오류:', error);
                alert('통합 중 오류가 발생했습니다: ' + error.message);
            }
        }
        
        // 통합 결과 표시
        function showMixedResult(content, sourceCount) {
            const finalOutput = document.getElementById('finalOutput');
            finalOutput.classList.add('show');
            
            document.getElementById('selectedModel').innerHTML = `
                <i class="fas fa-blender"></i> Gemini 통합 콘텐츠 
                <span style="font-size: 14px; color: #999;">
                    (${sourceCount}개 모델 결과 통합)
                </span>
            `;
            document.getElementById('finalContent').textContent = content;
            
            // 스크롤
            finalOutput.scrollIntoView({ behavior: 'smooth' });
        }
        
        // 초기화
        window.onload = () => {
            console.log('Page loaded, initializing grid...');
            initializeGrid();
            
            // 3초 후 그리드 상태 다시 확인
            setTimeout(() => {
                const grid = document.getElementById('modelsGrid');
                console.log('Grid check after 3 seconds:');
                console.log('- Total children:', grid.children.length);
                console.log('- Grid computed style:', window.getComputedStyle(grid).display);
                console.log('- Grid dimensions:', grid.offsetWidth + 'x' + grid.offsetHeight);
                
                Array.from(grid.children).forEach((child, index) => {
                    console.log(`Card ${index + 1} (${child.id}):`, {
                        visible: child.offsetParent !== null,
                        dimensions: child.offsetWidth + 'x' + child.offsetHeight,
                        position: `top: ${child.offsetTop}, left: ${child.offsetLeft}`
                    });
                });
            }, 3000);
        };
    </script>
</body>
</html>